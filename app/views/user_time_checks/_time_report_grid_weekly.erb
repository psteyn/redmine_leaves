
<%=define_grid @time_report_grid_weekly, hide_submit_button: true, hide_csv_button: false, hide_reset_button: true do |e|


  e.column name: 'Week #  ', html: {style: 'text-align: center'} do |t|
    t.week
    #  time=Time.at(t.week)
  # time.strftime("%W") 
    end
  e.column name: 'Week Start Date', html: {style: 'text-align: center'} do |t|

    time=Time.at(t.weekdays.beginning_of_week)
    time.strftime("%F")
    end
  e.column name: 'Week End Date', html: {style: 'text-align: center'} do |t|
    time=Time.at(t.weekdays.end_of_week)
    time.strftime("%F")
    end

  e.column name: l(:field_user_id), html: {style: 'text-align: center'}, 
    :attribute => 'user_id',
    detach_with_id: 'user_filter' ,
    custom_filter: User.active.collect{|u|[u.name, u.id]}  do |t|
    t.user.name unless t.user.nil? 
    end


  e.column name: 'Total Time Checked', html: {style: 'text-align: center'}   do |t|
    unless t.time_spent.nil?
      time_spent_date = Time.new(Time.now.year) + t.time_spent
      time_spent_date.strftime("%H:%M:%S")
    end
  end
  
  e.column name: 'Total Time Logged', html: {style: 'text-align: center'}   do |t|
    #select sum(hours) from time_entries where user_id = 164 and date(created_on) between date('2015-09-01') and date('2015-09-11') 
    @time_spent_this_week = TimeEntry.where(['user_id = ? and created_on between date(?) and date(?)', t.user_id,Time.at(t.weekdays.beginning_of_week),Time.at(t.weekdays.end_of_week)]).sum(:hours)
     logger.debug("\nMOO: #{@time_spent_this_week.inspect}\n")
    unless t.time_spent.nil?
      @time_spent_this_week.round(2)
    end
  end
  
  end %>
